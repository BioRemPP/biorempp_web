# ============================================================================
# BioRemPP v1.0 - Configuração de Produção (Sem Docker)
# ============================================================================
# Este arquivo deve ser copiado para .env no servidor
# Comando: cp .env.production .env
# ============================================================================
# IMPORTANTE: Ajuste os valores marcados com [ALTERAR] antes de usar
# ============================================================================

# ============================================================================
# AMBIENTE
# ============================================================================
BIOREMPP_ENV=production

# ============================================================================
# SERVIDOR - Configuração para Gunicorn
# ============================================================================
# Host: 0.0.0.0 permite conexões de qualquer IP (necessário para Nginx)
BIOREMPP_HOST=0.0.0.0

# Porta: 8080 (padrão produção, Nginx fará proxy reverso)
# [VERIFICAR] Se porta 8080 já estiver em uso, altere para 8081, 8082, etc.
BIOREMPP_PORT=8080

# Debug: SEMPRE False em produção
BIOREMPP_DEBUG=False

# Hot Reload: SEMPRE False em produção
BIOREMPP_HOT_RELOAD=False

# ============================================================================
# LOGGING
# ============================================================================
# Log Level: WARNING em produção (menos verboso)
# Opções: DEBUG | INFO | WARNING | ERROR | CRITICAL
BIOREMPP_LOG_LEVEL=WARNING

# ============================================================================
# GUNICORN - Servidor WSGI de Produção
# ============================================================================
# WORKERS: Número de processos worker
# Fórmula recomendada: (2 x CPU_cores) + 1
#
# Para servidor com 1GB RAM (Digital Ocean básico):
#   BIOREMPP_WORKERS=2  (recomendado para evitar alto uso de memória)
#
# Para servidor com 2GB+ RAM:
#   BIOREMPP_WORKERS=4  (melhor performance)
#
# Para servidor com 4GB+ RAM e 2+ CPUs:
#   BIOREMPP_WORKERS=5  (fórmula: 2x2+1)
#
# SEU SERVIDOR: 2GB RAM, 1 vCPU (Digital Ocean NYC3)
# Configuração recomendada: 4 workers (bom equilíbrio entre performance e estabilidade)
BIOREMPP_WORKERS=4

# WORKER CLASS: Tipo de worker
# - gevent: Async, recomendado para aplicações I/O-bound (uploads, API calls)
# - sync: Padrão, bloqueante, usa menos memória
# Para servidor 2GB RAM: gevent oferece melhor performance para Dash (muitos callbacks)
# Recomendação: gevent (melhor performance com 2GB disponível)
BIOREMPP_WORKER_CLASS=gevent

# WORKER CONNECTIONS: Máximo de conexões simultâneas por worker (apenas gevent)
# Padrão: 1000 (adequado para maioria dos casos)
BIOREMPP_WORKER_CONNECTIONS=1000

# TIMEOUT: Tempo máximo para processar uma requisição (segundos)
# BioRemPP pode ter análises longas, então timeout alto é necessário
# 300s = 5 minutos (recomendado)
# [ALTERAR] Se análises demorarem mais, aumente para 600 (10 min)
BIOREMPP_TIMEOUT=300

# KEEPALIVE: Tempo de manter conexão ativa após resposta (segundos)
BIOREMPP_KEEPALIVE=5

# MAX REQUESTS: Reinicia worker após N requisições (previne memory leaks)
# 0 = nunca reiniciar, 1000 = reiniciar a cada 1000 requisições
BIOREMPP_MAX_REQUESTS=1000

# MAX REQUESTS JITTER: Variação aleatória para evitar restart simultâneo
BIOREMPP_MAX_REQUESTS_JITTER=100

# ============================================================================
# UPLOAD - Limites de Arquivo
# ============================================================================
# Tamanho máximo de upload (MB)
# [ALTERAR] Se precisar aceitar arquivos maiores, aumente este valor
# IMPORTANTE: Também precisa ajustar no Nginx (client_max_body_size)
BIOREMPP_UPLOAD_MAX_SIZE_MB=100

# Limite de amostras por upload
BIOREMPP_UPLOAD_SAMPLE_LIMIT=1000

# Limite de KOs por upload
BIOREMPP_UPLOAD_KO_LIMIT=500000

# Encoding padrão de arquivos
BIOREMPP_UPLOAD_ENCODING=utf-8

# ============================================================================
# PROCESSAMENTO
# ============================================================================
# Timeout de processamento (segundos)
BIOREMPP_PROCESSING_TIMEOUT=300

# Máximo de tentativas em caso de erro
BIOREMPP_PROCESSING_MAX_RETRIES=2

# Delay entre tentativas (segundos)
BIOREMPP_PROCESSING_RETRY_DELAY=1

# Circuit breaker - threshold de falhas
BIOREMPP_PROCESSING_CIRCUIT_BREAKER_THRESHOLD=3

# Circuit breaker - timeout (segundos)
BIOREMPP_PROCESSING_CIRCUIT_BREAKER_TIMEOUT=30

# ============================================================================
# CACHE (Opcional - Requer Redis)
# ============================================================================
# Habilitar cache Redis (melhora performance significativamente)
# False = Usa cache em memória (padrão, sem dependência externa)
# True = Usa Redis (requer instalação e configuração do Redis)
#
# [ALTERAR] Para habilitar Redis:
#   1. Instalar Redis: sudo apt-get install redis-server
#   2. Alterar ENABLE_CACHE=True
#   3. Configurar REDIS_HOST, REDIS_PORT abaixo
ENABLE_CACHE=False

# Configurações Redis (apenas se ENABLE_CACHE=True)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# Cache timeout padrão (segundos)
CACHE_DEFAULT_TIMEOUT=300

# Cache threshold (número máximo de itens em cache)
CACHE_THRESHOLD=1000

# ============================================================================
# SEGURANÇA
# ============================================================================
# SECRET_KEY: Chave secreta para operações criptográficas
# [ALTERAR] Gere uma chave única com:
#   python -c "import secrets; print(secrets.token_hex(32))"
#
# NUNCA use a chave padrão em produção!
SECRET_KEY=REPLACE_WITH_SECURE_KEY_GENERATE_WITH_PYTHON_SECRETS_TOKEN_HEX

# ============================================================================
# SSL/HTTPS (Informações para referência - Configurado no Nginx)
# ============================================================================
# Estas variáveis são apenas informativas, o SSL é configurado no Nginx
# Configuração para produção - biorempp.cloud
ENABLE_HTTPS=True
DOMAIN=biorempp.cloud
LETSENCRYPT_EMAIL=biorempp@gmail.com

# ============================================================================
# PERFORMANCE
# ============================================================================
# Habilitar compressão (recomendado)
ENABLE_COMPRESSION=True

# Habilitar profiling (apenas para debugging, desabilitar em produção)
ENABLE_PROFILING=False

# ============================================================================
# DESENVOLVIMENTO (Sempre False em Produção)
# ============================================================================
DASH_DEBUG=False

# ============================================================================
# PARSING LIMITS
# ============================================================================
BIOREMPP_PARSING_MAX_SAMPLES=1000
BIOREMPP_PARSING_MAX_KOS_PER_SAMPLE=10000
BIOREMPP_PARSING_MAX_TOTAL_KOS=100000

# ============================================================================
# VALIDAÇÃO
# ============================================================================
# Padrão regex para validação de KO IDs
BIOREMPP_KO_PATTERN=^K\d{5}$

# Padrão regex para validação de nomes de amostras
BIOREMPP_SAMPLE_NAME_PATTERN=^[a-zA-Z0-9_\-\.]+$

# ============================================================================
# NOTAS IMPORTANTES
# ============================================================================
#
# 1. MEMÓRIA DO SERVIDOR (SEU SERVIDOR: 2GB RAM, 1 vCPU):
#    - Servidor 1GB RAM: Use BIOREMPP_WORKERS=2
#    - Servidor 2GB RAM: Use BIOREMPP_WORKERS=4 ← VOCÊ ESTÁ AQUI
#    - Servidor 4GB+ RAM: Use BIOREMPP_WORKERS=4-8
#
# 2. PORTA:
#    - A porta 8080 NÃO deve ser exposta externamente
#    - Apenas localhost:8080 (Nginx faz proxy reverso)
#    - Portas 80/443 são gerenciadas pelo Nginx
#
# 3. TIMEOUT:
#    - Se análises demorarem mais que 5 minutos, aumente BIOREMPP_TIMEOUT
#    - Também ajuste BIOREMPP_PROCESSING_TIMEOUT para o mesmo valor
#
# 4. NGINX:
#    - Certifique-se que client_max_body_size >= BIOREMPP_UPLOAD_MAX_SIZE_MB
#    - Timeouts do Nginx devem ser >= BIOREMPP_TIMEOUT
#
# 5. CACHE:
#    - Redis melhora muito a performance mas requer instalação
#    - Cache em memória (padrão) funciona bem para cargas moderadas
#
# 6. WORKERS:
#    - Mais workers = mais memória usada
#    - Menos workers = menos requisições simultâneas
#    - Ajuste baseado no uso real após migração
#
# ============================================================================
